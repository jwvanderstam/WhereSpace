{% extends "layout.html" %}

{% block title %}Dashboard - WhereSpace{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1 class="card-title">Welcome to WhereSpace</h1>
    </div>
    
    <p style="font-size: 16px; line-height: 1.8; margin-bottom: 30px;">
        <strong>WhereSpace</strong> is your intelligent document assistant powered by local LLMs. 
        Index your documents, ask questions, and get AI-powered answers based on your content.
    </p>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px;">
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h3 style="font-size: 32px; margin-bottom: 10px;" id="total-docs">-</h3>
            <p style="opacity: 0.9;">Documents Indexed</p>
        </div>
        
        <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
            <h3 style="font-size: 32px; margin-bottom: 10px;" id="total-chunks">-</h3>
            <p style="opacity: 0.9;">Content Chunks</p>
        </div>
        
        <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
            <h3 style="font-size: 32px; margin-bottom: 10px;" id="current-model">llama3.1</h3>
            <p style="opacity: 0.9;">Active LLM Model</p>
        </div>
        
        <div class="card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
            <h3 style="font-size: 32px; margin-bottom: 10px;">768D</h3>
            <p style="opacity: 0.9;">Vector Dimensions</p>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">System Status</h2>
    </div>
    
    <div style="display: grid; gap: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--light); border-radius: 8px;">
            <span style="font-weight: 600;">PostgreSQL + pgvector</span>
            <span style="color: var(--success); font-weight: 600;">Connected</span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--light); border-radius: 8px;">
            <span style="font-weight: 600;">Ollama LLM Server</span>
            <span style="color: var(--success); font-weight: 600;" id="ollama-status">Online</span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--light); border-radius: 8px;">
            <span style="font-weight: 600;">Document Processing</span>
            <span style="color: var(--success); font-weight: 600;">Ready</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Load dashboard stats
    async function loadDashboardStats() {
        try {
            const response = await fetch('/api/status');
            const data = await response.json();
            
            document.getElementById('total-docs').textContent = data.document_count || 0;
            document.getElementById('total-chunks').textContent = 
                data.document_count ? (data.document_count * 15) + '+' : 0;
            document.getElementById('current-model').textContent = data.current_model || 'llama3.1';
            
            // Update Ollama status
            const ollamaStatus = document.getElementById('ollama-status');
            if (data.ollama_available) {
                ollamaStatus.innerHTML = 'Online';
                ollamaStatus.style.color = 'var(--success)';
            } else {
                ollamaStatus.innerHTML = 'Offline';
                ollamaStatus.style.color = 'var(--danger)';
            }
        } catch (error) {
            console.error('Error loading dashboard stats:', error);
        }
    }

    loadDashboardStats();
    setInterval(loadDashboardStats, 10000);
</script>
{% endblock %}
